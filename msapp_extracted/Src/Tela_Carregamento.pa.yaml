# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Tela_Carregamento:
    Properties:
      LoadingSpinnerColor: =RGBA(56, 96, 178, 1)
      OnVisible: =Select(Button3);
    Children:
      - Button3:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnSelect: |-
              =If(
                  !_modoDesenvolvedor,
                  Set(
                      _avisoCarregando,
                      "Definindo valores iniciais..."
                  );
                  Set(
                      _nivelCarregando2,
                      25
                  );
                  // Recupera o registro de Usuários
                  UpdateContext(
                      {
                          registroMaisRecente:
                          LookUp(
                              SAVe_Usuarios,
                              Usuario.Email = User().Email
                          )
                      }
                  );
                  // Verifica se o campo 'Tema' não está vazio
                  If(
                      !IsBlank(registroMaisRecente.Tema),
                  // Analisa o JSON do tema e define a variável 'cor' como um registro tipado
                      Set(
                          cor,
                          {
                              tema: ColorValue(ParseJSON(registroMaisRecente.Tema).tema),
                              textoPrincipal: ColorValue(ParseJSON(registroMaisRecente.Tema).textoPrincipal),
                              textoSecundaria: ColorValue(ParseJSON(registroMaisRecente.Tema).textoSecundaria),
                              verde: ColorValue(ParseJSON(registroMaisRecente.Tema).verde),
                              azul: ColorValue(ParseJSON(registroMaisRecente.Tema).azul),
                              roxo: ColorValue(ParseJSON(registroMaisRecente.Tema).roxo),
                              vermelho: ColorValue(ParseJSON(registroMaisRecente.Tema).vermelho),
                              amarelo: ColorValue(ParseJSON(registroMaisRecente.Tema).amarelo),
                              laranja: ColorValue(ParseJSON(registroMaisRecente.Tema).laranja),
                              fundoClaro: ColorValue(ParseJSON(registroMaisRecente.Tema).fundoClaro),
                              fundoEscuro: ColorValue(ParseJSON(registroMaisRecente.Tema).fundoEscuro),
                              cinzaClaro: ColorValue(ParseJSON(registroMaisRecente.Tema).cinzaClaro),
                              cinzaMedio: ColorValue(ParseJSON(registroMaisRecente.Tema).cinzaMedio),
                              cinzaEscuro: ColorValue(ParseJSON(registroMaisRecente.Tema).cinzaEscuro),
                              bordaClara: ColorValue(ParseJSON(registroMaisRecente.Tema).bordaClara),
                              bordaEscura: ColorValue(ParseJSON(registroMaisRecente.Tema).bordaEscura),
                              sucesso: ColorValue(ParseJSON(registroMaisRecente.Tema).sucesso),
                              erro: ColorValue(ParseJSON(registroMaisRecente.Tema).erro),
                              aviso: ColorValue(ParseJSON(registroMaisRecente.Tema).aviso),
                              informacao: ColorValue(ParseJSON(registroMaisRecente.Tema).informacao),
                              destaquePrimario: ColorValue(ParseJSON(registroMaisRecente.Tema).destaquePrimario),
                              destaqueSecundario: ColorValue(ParseJSON(registroMaisRecente.Tema).destaqueSecundario),
                              sombraLeve: ColorValue(ParseJSON(registroMaisRecente.Tema).sombraLeve),
                              sombraIntensa: ColorValue(ParseJSON(registroMaisRecente.Tema).sombraIntensa)
                          }
                      ),
                  // Inicializa a cor tema com um valor padrão
                      Set(
                          cor,
                          {
                              tema: ColorValue("#007cbe"),
                              textoPrincipal: ColorValue("#343a40"),
                              textoSecundaria: ColorValue("#98a6ad"),
                              verde: ColorValue("#17c653"),
                              azul: ColorValue("#1b84ff"),
                              roxo: ColorValue("#7239ea"),
                              vermelho: ColorValue("#f8285a"),
                              amarelo: ColorValue("#f6c000"),
                              laranja: ColorValue("#FF8400"),
                              // Cores neutras e de fundo
                              fundoClaro: ColorValue("#f8f9fa"),
                              fundoEscuro: ColorValue("#343a40"),
                              cinzaClaro: ColorValue("#e9ecef"),
                              cinzaMedio: ColorValue("#ced4da"),
                              cinzaEscuro: ColorValue("#6c757d"),
                              // Cores de borda
                              bordaClara: ColorValue("#dee2e6"),
                              bordaEscura: ColorValue("#495057"),
                              // Estados (sucesso, erro, aviso, informação)
                              sucesso: ColorValue("#28a745"),
                              erro: ColorValue("#dc3545"),
                              aviso: ColorValue("#ffc107"),
                              informacao: ColorValue("#17a2b8"),
                              // Destaques
                              destaquePrimario: ColorValue("#0056b3"),
                              destaqueSecundario: ColorValue("#6f42c1"),
                              // Cores de sombra (para efeitos visuais)
                              sombraLeve: RGBA(
                                  0,
                                  0,
                                  0,
                                  0.1
                              ),
                              sombraIntensa: RGBA(
                                  0,
                                  0,
                                  0,
                                  0.3
                              )
                          }
                      )
                  );
                  Set(
                      _avisoCarregando,
                      "Verificando Usuário..."
                  );
                  Set(
                      _nivelCarregando2,
                      _nivelCarregando2 + 50
                  );
                  If(
                      IsBlankOrError(
                          LookUp(
                              SAVe_Usuarios,
                              Usuario.Email = User().Email
                          )
                      ),
                      UpdateContext(
                          {
                              _UserPesquisado: First(
                                  UsuáriosdoOffice365.SearchUserV2(
                                      {
                                          searchTerm: User().Email,
                                          top: 1
                                      }
                                  ).value
                              )
                          }
                      );
                      Patch(
                          SAVe_Usuarios,
                          Defaults(SAVe_Usuarios),
                          {
                              Usuario: {
                                  '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedUser",
                                  Claims: "i:0#.f|membership|" & Lower(_UserPesquisado.Mail),
                                  DisplayName: _UserPesquisado.DisplayName,
                                  Email: _UserPesquisado.Mail,
                                  Department: _UserPesquisado.Department,
                                  JobTitle: _UserPesquisado.JobTitle,
                                  Picture: UsuáriosdoOffice365.UserPhotoV2(_UserPesquisado.Mail)
                              },
                              Cargo: "Usuário"
                          }
                      );
                      UpdateContext({_UserPesquisado: Blank()})
                  );
                  Set(
                      _meuCargo,
                      LookUp(
                          SAVe_Usuarios,
                          Usuario.Email = User().Email,
                          Cargo
                      )
                  );
                  Set(
                      _logAtual,
                      Patch(
                          SAVe_Logs_Acesso,
                          {
                              email: User().Email
                          }
                      )
                  );
                  Set(
                      _avisoCarregando,
                      "Carregamento concluído com sucesso! Redirecionando para página inicial..."
                  );
                  Set(
                      _nivelCarregando2,
                      100
                  );
                  Set(
                      _atualizando,
                      false
                  );
                  // Finaliza a captura de dados da base de casos.
                  Set(
                      _filtro,
                      "Modified"
                  );
                  Set(
                      _ordemFiltro,
                      SortOrder.Descending
                  );
                  Navigate(Tela_Entrada)
              );
              Set(
                  _avisoCarregando,
                  Blank()
              )
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            X: =64
            Y: =107
      - Carregamento_2:
          Control: CanvasComponent
          ComponentName: Carregamento
          Properties:
            Fill: =ColorFade(cor.tema, 70%)
            Height: =768
            Texto_Carregamento: =_avisoCarregando
            Width: =1366
            cor_tema: =cor.tema
      - Progress1:
          Control: Progress@1.1.34
          Properties:
            Height: =80
            ProgressColor: ='Progress.ProgressColor'.Brand
            Thickness: ='Progress.Thickness'.Large
            Value: =_nivelCarregando2
            Visible: =_avisoCarregando <> "Carregamento concluído com sucesso! Redirecionando para página inicial..."
            Width: =425
            X: =470
            Y: =475
      - TextCanvas1:
          Control: Text@0.0.51
          Properties:
            Align: ='TextCanvas.Align'.Center
            Font: =Font.Lato
            FontColor: =RGBA(255, 255, 255, 1)
            Text: =_avisoCarregando
            VerticalAlign: =VerticalAlign.Middle
            Visible: =false
            Width: =Progress1.Width + 50
            X: =(Parent.Width - Self.Width)/2
            Y: =475
      - LogoMPEntrada_1:
          Control: Image@2.2.3
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Height: =45
            Image: ='logo-mp'
            ImagePosition: =ImagePosition.Fill
            Width: =230
            X: =LogoSavEEntrada_1.X + LogoSavEEntrada_1.Width
            Y: =680
      - LogoCasaLilianEntrada_1:
          Control: Image@2.2.3
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Height: =45
            Image: ='logo-01'
            ImagePosition: =ImagePosition.Fill
            Width: =230
            X: =LogoSavEEntrada_1.X - Self.Width
            Y: =682
      - LogoSavEEntrada_1:
          Control: Image@2.2.3
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Image: ='Logo-SavE'
            ImagePosition: =ImagePosition.Fill
            Width: =500
            X: =Parent.Width/2 - Self.Width/2
            Y: =650
